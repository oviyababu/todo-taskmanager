<div class="container mt-5">
  <div class="d-flex justify-content-between mb-3">
    <h4>Hey {{ username }} ðŸ‘‹</h4>
    <button class="btn btn-danger" (click)="logout()">Logout</button>
  </div>

  <!-- Title -->
  <input
    [(ngModel)]="newTask.title"
    class="form-control mb-3"
    placeholder="Task title"
  />

  <!-- Description -->
  <label class="mb-1">Description</label>

  <!-- Toolbar -->
  <div class="editor-toolbar mb-2">
    <button class="btn btn-sm btn-light" (click)="format('bold')">B</button>
    <button class="btn btn-sm btn-light" (click)="format('italic')">I</button>
    <button class="btn btn-sm btn-light" (click)="format('underline')">U</button>
    <button class="btn btn-sm btn-light" (click)="format('insertUnorderedList')">â€¢ List</button>
  </div>

  <!-- Editable area -->
  <div
    contenteditable="true"
    class="form-control editor-box mb-3"
    (input)="updateDescription($event)">
  </div>

  <!-- Due Date -->
  <label class="mb-1">Due Date</label>
  <input
    type="date"
    [(ngModel)]="newTask.dueDate"
    class="form-control mb-3"
    [min]="minDate"
  />

  <!-- Add Task -->
  <button class="btn btn-primary w-100" (click)="addTask()">
    {{ isEditMode ? 'Update Task' : 'Add Task' }}
  </button>

  <br><br>

  <!-- Task List -->
  <div
    class="card shadow-sm mb-3 task-card"
    *ngFor="let task of tasks"
  >

    <!-- Title row -->
    <div
      class="card-body d-flex justify-content-between align-items-center"
    >
      <div class="d-flex align-items-center gap-2">

        <!-- Status checkbox -->
        <input
          type="checkbox"
          [checked]="task.status === 'COMPLETED'"
          (change)="toggleStatus(task)"
        />

        <!-- Title (click only here to expand) -->
        <h6
          class="mb-0 clickable-title"
          (click)="task.expanded = !task.expanded"
          [class.completed-text]="task.status === 'COMPLETED'"
        >
          {{ task.title }}
        </h6>

        <!-- Status badge -->
        <span
          class="badge"
          [ngClass]="task.status === 'COMPLETED' ? 'bg-success' : 'bg-warning text-dark'"
        >
          {{ task.status }}
        </span>
      </div>

      <!-- Action buttons -->
      <div>
        <button
          class="btn btn-sm btn-outline-primary me-2"
          (click)="editTask(task)">
          Edit
        </button>

        <button
          class="btn btn-sm btn-outline-danger"
          (click)="deleteTask(task.id)">
          Delete
        </button>
      </div>
    </div>

    <!-- Expanded content -->
    <div class="card-body pt-0" *ngIf="task.expanded">

      <!-- Description -->
      <div
        class="task-description"
        [innerHTML]="task.description || 'No description provided'">
      </div>

      <!-- Created Date -->
      <small class="created-date d-block">
        Created: {{ task.createdAt | date:'medium' }}
      </small>

      <!-- Due Date -->
      <small class="due-date d-block">
        Due: {{ task.dueDate }}
      </small>

    </div>

  </div>
</div>
